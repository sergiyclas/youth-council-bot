from openai import OpenAI
from config import OPENAI_KEY

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–ª—ñ—î–Ω—Ç–∞ OpenAI
client = OpenAI(
    api_key=OPENAI_KEY  # –ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –≤—Å—Ç–∞–≤—Ç–µ –≤–∞—à API-–∫–ª—é—á
)

async def generate_post(client, event_info, max_length=750):
    """
    –ì–µ–Ω–µ—Ä—É—î –ø–æ—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–µ—Ä–µ–¥–∞–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º –Ω–∞ –¥–æ–≤–∂–∏–Ω—É.

    :param client: –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –∫–ª—ñ—î–Ω—Ç OpenAI
    :param event_info: –¢–µ–∫—Å—Ç–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–æ–¥—ñ—é
    :param max_length: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –¥–æ–≤–∂–∏–Ω–∞ –ø–æ—Å—Ç—É –≤ —Å–∏–º–≤–æ–ª–∞—Ö (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 750)
    :return: –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –ø–æ—Å—Ç –∞–±–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É
    """
    prompt = f"""
        –¢–∏ ‚Äî –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π –∫–æ–ø—ñ—Ä–∞–π—Ç–µ—Ä, —è–∫–∏–π —Å—Ç–≤–æ—Ä—é—î –ø–æ—Å—Ç–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –¥–ª—è —Å–æ—Ü—ñ–∞–ª—å–Ω–∏—Ö –º–µ—Ä–µ–∂ —É —Å—Ç–∏–ª—ñ –ú–æ–ª–æ–¥—ñ–∂–Ω–æ—ó —Ä–∞–¥–∏ –ø—Ä–∏ –†–∞–≤–∞-–†—É—Å—å–∫—ñ–π –º—ñ—Å—å–∫—ñ–π —Ä–∞–¥—ñ. –ó–∞–≤–∂–¥–∏ –¥–æ—Ç—Ä–∏–º—É–π—Å—è —Ç–∞–∫–æ–≥–æ —Å—Ç–∏–ª—é —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏:
        - –º–∞–∫—Å–∏–º—É–º 3 –µ–º–æ–¥–∑—ñ –Ω–∞ –ø–æ—Å—Ç!
        - –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π —Å—Ç–∏–ª—å –º–æ–≤–ª–µ–Ω–Ω—è!
        - –±–µ–∑ —Ö–µ—à—Ç–µ–≥—ñ–≤ —ñ —Ç–µ–≥—ñ–≤!
        - –æ–±–º–µ–∂–µ–Ω–Ω—è –≤ 700 —Å–∏–º–≤–æ–ª—ñ–≤ –Ω–∞ –ø–æ—Å—Ç!
        
        1. –ü–æ—á–Ω–∏ –∑ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ, –∞–ª–µ –µ–º–æ—Ü—ñ–π–Ω–æ–≥–æ –≤—Å—Ç—É–ø—É. –ù–∞–ø—Ä–∏–∫–ª–∞–¥:
           - –°–ø–µ—Ä—à—É —â–æ –∑–∞ –ø–æ–¥—ñ—è, –¥–∞–ª—ñ –≤–∫–∞–∑–∞–Ω–∞ –¥–∞—Ç–∞ —ñ –ø–æ—Ç—ñ–º –¥–µ –≤–æ–Ω–æ –≤—ñ–¥–±—É–ª–æ—Å—è —ñ –≤ —Ä–∞–º–∫–∞—Ö —á–æ–≥–æ, —è–∫—â–æ —Ü–µ –ø—Ä–∏—Å—É—Ç–Ω—î.

        2. –í –æ—Å–Ω–æ–≤–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ:
           - –û–ø–∏—à–∏ –ø–æ–¥—ñ—é (–¥–∞—Ç–∞, –º—ñ—Å—Ü–µ, —É—á–∞—Å–Ω–∏–∫–∏).
           - –ó—Ä–æ–±–∏ —Ç–µ–∫—Å—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–º, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–∞—Ä–∫–µ—Ä–∏ —á–∏ —Å–ø–∏—Å–∫–∏, –∞–ª–µ –∫–æ—Ä–æ—Ç–∫–æ. –ù–∞–ø—Ä–∏–∫–ª–∞–¥:
             üîπ –°–∏–ª—å–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏, —è–∫—ñ –Ω–∞—Å –æ–±‚Äô—î–¥–Ω—É—é—Ç—å.
             üîπ –ü—Ä–æ–±–ª–µ–º–∏, –Ω–∞–¥ —è–∫–∏–º–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏.
           - –î–æ–¥–∞–π –¥–µ—Ç–∞–ª—ñ –ø—Ä–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ, –∫–ª—é—á–æ–≤—ñ —Ç–µ–º–∏ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è, –≤–Ω–µ—Å–æ–∫ —É—á–∞—Å–Ω–∏–∫—ñ–≤.

        3. –£ –∑–∞–∫–ª—é—á–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ:
           - –í–∏—Å–ª–æ–≤–∏ –ø–æ–¥—è–∫—É –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ç–æ—Ä–∞–º, –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º —á–∏ —É—á–∞—Å–Ω–∏–∫–∞–º.
           - –î–æ–¥–∞–π –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—É —Ñ—Ä–∞–∑—É, —è–∫–∞ –º–æ—Ç–∏–≤—É—î –¥–æ–ª—É—á–∏—Ç–∏—Å—è –¥–æ –º–∞–π–±—É—Ç–Ω—ñ—Ö –ø–æ–¥—ñ–π.

        –ù–∞–ø–∏—à–∏ –ø–æ—Å—Ç —É —Ü—å–æ–º—É —Å—Ç–∏–ª—ñ. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —á—ñ—Ç–∫–µ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —ñ —Å—Ç—Ä—É–∫—Ç—É—Ä—É–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É.
        
        –û—Å—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è –ø–æ—Å—Ç—É:
        {event_info}

    """
    # –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ max_tokens –¥–ª—è OpenAI (1 —Ç–æ–∫–µ–Ω ‚âà 4 —Å–∏–º–≤–æ–ª–∏)
    max_tokens = max_length

    try:
        # –í–∏–∫–ª–∏–∫ API –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É
        completion = client.chat.completions.create(
            model="gpt-4",
            store=True,
            messages=[
                {"role": "user", "content": prompt}
            ],
            max_tokens=max_tokens
        )

        # –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç
        return completion.choices[0].message.content

    except Exception as e:
        return f"–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞: {e}"